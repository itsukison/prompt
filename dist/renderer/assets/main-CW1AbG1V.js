import{u as E,r as s,j as e,B as S,R as W,a as B,P as G}from"./styles-B_Wz-rS5.js";function M(r,i){const l=E(),c=s.useRef(r),x=s.useRef(i);s.useEffect(()=>{c.current=r},[r]),s.useEffect(()=>{x.current=i},[i]),s.useEffect(()=>{const u=a=>c.current?.(a),o=()=>x.current?.(),f=r?l.onWindowShown(u):void 0,b=i?l.onWindowHidden(o):void 0;return()=>{f?.(),b?.()}},[l])}const D=e.jsxs("svg",{className:"w-[18px] h-[18px]",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 2L11 13"}),e.jsx("path",{d:"M22 2L15 22L11 13L2 9L22 2Z"})]});function F(){const r=E(),[i,l]=s.useState(""),[c,x]=s.useState(""),[u,o]=s.useState(""),[f,b]=s.useState(!1),a=s.useRef(null),v=s.useRef(!1),[g,p]=s.useState(""),[m,w]=s.useState(""),y=!!c,C=!!u,n=s.useCallback(()=>{l(""),x(""),o(""),p(""),w("")},[]),O=s.useCallback(t=>{n(),t?.selection&&w(t.selection),a.current?.focus()},[n]),L=s.useCallback(()=>{n()},[n]);M(O,L),s.useEffect(()=>{if(window.promptOS&&window.promptOS.onGenerationStatus)return window.promptOS.onGenerationStatus(t=>{p(t)})},[r]),s.useEffect(()=>{if(window.promptOS&&window.promptOS.onContextUpdated)return window.promptOS.onContextUpdated(t=>{t?.selection&&(w(t.selection),a.current?.focus())})},[r]);const j=s.useCallback(async()=>{const t=a.current?.value.trim()||"";if(!(!t||v.current))try{v.current=!0,b(!0),o(""),p("");let d=t;m&&(d=`Context:
"""
${m}
"""

User Request:
${t}`);let k=!1;try{const R=await r.checkContextNeed(t);k=R.needsContext,k&&(console.log("[Overlay] Including screenshot (source:",R.source,")"),p("Capturing context..."))}catch{console.warn("[Overlay] Context check failed, continuing without screenshot")}const h=await r.generate(d,{includeScreenshot:k});h.success&&h.text?x(h.text):h.error==="screen_recording_permission"?o("screen_recording_permission"):o(h.error||"Failed to generate text")}catch{o("An unexpected error occurred")}finally{v.current=!1,b(!1),p("")}},[r,m]),_=s.useCallback(async()=>{const t=c;if(t)try{await r.insert(t),n()}catch{o("Failed to insert text")}},[r,c,n]),I=s.useCallback(()=>{a.current?.focus(),a.current?.select()},[]),N=s.useCallback(()=>{r.dismiss(),n()},[r,n]),P=s.useCallback(t=>{t.nativeEvent.isComposing||t.repeat||(t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),j()):t.key==="Escape"&&N())},[j,N]);return s.useEffect(()=>{const t=d=>{d.key==="Escape"&&(r.dismiss(),n())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[r,n]),e.jsxs("div",{className:"bg-transparent h-screen flex flex-col justify-end items-center p-3 pb-6 font-[-apple-system,BlinkMacSystemFont,'Segoe_UI',Roboto,Oxygen,Ubuntu,sans-serif]",children:[y&&e.jsxs("div",{className:"mb-3 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-[20px] p-5 shadow-lg animate-slide-up origin-bottom w-full max-h-[calc(100vh-100px)] overflow-y-auto",children:[e.jsx("div",{className:"result-text text-[15px] leading-relaxed text-gray-200 max-h-[350px] overflow-y-auto whitespace-pre-wrap pr-1",children:c}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-end",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:I,className:"text-[13px] text-gray-400 px-2.5 py-1.5 rounded-xl hover:text-gray-200 active:scale-95",children:"Refine"}),e.jsx(S,{variant:"ghost",size:"sm",onClick:_,className:"bg-[#FF6B00] hover:bg-[#ff8533] text-white rounded-xl px-3.5 py-1.5 text-[13px] font-medium active:scale-95",children:"Insert"})]})]}),C&&(u==="screen_recording_permission"?e.jsx("div",{className:"mb-3 p-4 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-amber-500/30 backdrop-blur-xl rounded-[20px] shadow-lg animate-slide-up w-full",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400 text-lg flex-shrink-0",children:"⚠"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-medium text-amber-300 mb-1",children:"Screen Recording permission required"}),e.jsx("p",{className:"text-[12px] text-gray-400 leading-relaxed mb-2",children:"To read your screen for context, promptOS needs Screen Recording access."}),e.jsx("p",{className:"text-[11px] text-gray-500 font-mono leading-relaxed",children:"System Settings → Privacy & Security → Screen Recording → enable Electron"})]})]})}):e.jsx("div",{className:"mb-3 p-3 px-4 bg-red-50 rounded-2xl border border-red-300 shadow-[0_4px_12px_rgba(220,38,38,0.1)] text-red-700 text-sm animate-slide-up w-full",children:e.jsx("span",{children:u})})),g&&!y&&!C&&e.jsx("div",{className:"mb-3 p-2 px-4 bg-blue-500/10 rounded-2xl border border-blue-500/20 text-blue-200 text-xs animate-pulse w-fit mx-auto backdrop-blur-md",children:e.jsx("span",{children:g})}),m&&!y&&e.jsxs("div",{className:"mb-3 max-w-[90%] flex items-center gap-2 p-2 px-3 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-xl animate-slide-up",children:[e.jsxs("div",{className:"text-xs text-gray-300 italic truncate max-w-[300px]",children:['"',m,'"']}),e.jsx("button",{onClick:()=>w(""),className:"text-gray-400 hover:text-white transition-colors",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 6L6 18"}),e.jsx("path",{d:"M6 6l12 12"})]})})]}),e.jsxs("div",{className:"input-bar flex items-center gap-3.5 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-[28px] py-2.5 px-5 shadow-lg w-[92%]",children:[e.jsx("img",{src:"logo.png",className:"w-6 h-6 object-contain flex-shrink-0 opacity-80",alt:"Logo"}),e.jsx("input",{ref:a,type:"text",value:i,onChange:t=>l(t.target.value),onKeyDown:P,placeholder:g||"Ask AI...",autoComplete:"off",spellCheck:!1,className:"flex-1 bg-transparent border-none text-base text-gray-100 outline-none font-normal placeholder:text-gray-500"}),e.jsx(S,{variant:"ghost",size:"icon",onClick:j,disabled:f||!!g,className:"w-8 h-8 rounded-full text-gray-500 hover:bg-black/5 hover:text-gray-900 disabled:opacity-50",children:f?e.jsx("span",{className:"spinner"}):D})]})]})}W.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(G,{children:e.jsx(F,{})})}));
