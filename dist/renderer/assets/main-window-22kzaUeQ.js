import"./styles-Dt_C4Pzm.js";let y={displayName:"",writingStyle:null,writingStyleGuide:null},g={name:"",email:"",styleId:"professional",customStyleText:""};function p(o){document.querySelectorAll(".page").forEach(d=>d.classList.remove("active"));const i=document.getElementById(`page-${o}`);i&&(i.classList.add("active"),o==="settings"&&E())}window.promptOS&&window.promptOS.onNavigate(o=>{p(o)});function v(){const o=document.getElementById("auth-form"),i=document.getElementById("auth-email"),d=document.getElementById("auth-password"),e=document.getElementById("auth-submit"),a=document.getElementById("auth-toggle"),s=document.getElementById("auth-error"),r=document.getElementById("auth-title"),l=document.getElementById("auth-subtitle");let t=!1;a.addEventListener("click",()=>{t=!t,r.textContent=t?"Create account":"Welcome back",l.textContent=t?"Start your journey with a free account.":"Enter your credentials to access your workspace.",e.textContent=t?"Create Account":"Continue",a.textContent=t?"Already have an account? Sign in":"No account? Sign up",s.classList.add("hidden")}),o.addEventListener("submit",async n=>{n.preventDefault(),s.classList.add("hidden"),e.disabled=!0;const m=e.textContent;e.textContent=t?"Creating account...":"Signing in...";const u={email:i.value.trim(),password:d.value};try{const c=t?await window.promptOS.auth.signUp(u):await window.promptOS.auth.signIn(u);if(!c.success){s.textContent=c.error,s.classList.remove("hidden"),e.disabled=!1,e.textContent=m;return}t||c.needsOnboarding?p("onboarding-1"):p("settings")}catch{s.textContent="An unexpected error occurred",s.classList.remove("hidden"),e.disabled=!1,e.textContent=m}})}function S(){const o=document.getElementById("onboarding-1-form"),i=document.getElementById("display-name-input"),d=document.getElementById("onboarding-name-submit");i.addEventListener("input",()=>{d.disabled=!i.value.trim()}),o.addEventListener("submit",e=>{e.preventDefault();const a=i.value.trim();a&&(y.displayName=a,p("onboarding-2"))})}function f(){const o=document.querySelectorAll("#page-onboarding-2 .style-card"),i=document.getElementById("custom-style-container"),d=document.getElementById("custom-style-input"),e=document.getElementById("complete-onboarding"),a=document.getElementById("onboarding-back-btn");o.forEach(s=>{s.addEventListener("click",()=>{o.forEach(l=>{l.classList.remove("border-zinc-500","bg-zinc-800"),l.classList.add("border-zinc-800/50","bg-[#1e1e20]");const t=l.querySelector(".icon-container");t.classList.remove("bg-zinc-100","text-zinc-950"),t.classList.add("bg-zinc-900","text-zinc-500"),l.querySelector(".title").classList.remove("text-zinc-100"),l.querySelector(".title").classList.add("text-zinc-300"),l.querySelector(".example")?.classList.remove("text-zinc-300","border-zinc-500"),l.querySelector(".example")?.classList.add("text-zinc-600","border-zinc-800")}),s.classList.remove("border-zinc-800/50","bg-[#1e1e20]"),s.classList.add("border-zinc-500","bg-zinc-800");const r=s.querySelector(".icon-container");r.classList.remove("bg-zinc-900","text-zinc-500"),r.classList.add("bg-zinc-100","text-zinc-950"),s.querySelector(".title").classList.remove("text-zinc-300"),s.querySelector(".title").classList.add("text-zinc-100"),s.querySelector(".example")?.classList.remove("text-zinc-600","border-zinc-800"),s.querySelector(".example")?.classList.add("text-zinc-300","border-zinc-500"),y.writingStyle=s.dataset.style,s.dataset.style==="custom"?(i.classList.remove("hidden"),e.disabled=!d.value.trim()):(i.classList.add("hidden"),y.writingStyleGuide=null,e.disabled=!1)})}),d.addEventListener("input",()=>{y.writingStyleGuide=d.value.trim(),y.writingStyle==="custom"&&(e.disabled=!d.value.trim())}),a.addEventListener("click",()=>{p("onboarding-1")}),e.addEventListener("click",async()=>{if(!y.writingStyle)return;if(y.writingStyle==="custom"&&!y.writingStyleGuide){alert("Please enter your custom style instructions");return}e.disabled=!0;const s=e.innerHTML;e.textContent="Setting up...";try{const r=await window.promptOS.onboarding.complete({displayName:y.displayName,writingStyle:y.writingStyle,writingStyleGuide:y.writingStyleGuide});r.success||(alert("Failed to complete setup: "+r.error),e.disabled=!1,e.innerHTML=s)}catch{alert("Failed to complete setup"),e.disabled=!1,e.innerHTML=s}})}function w(){const o=document.querySelectorAll(".settings-nav-item"),i=document.querySelectorAll(".settings-tab-content"),d=document.getElementById("settings-page-title"),e=document.getElementById("logout-btn");o.forEach(l=>{l.addEventListener("click",()=>{const t=l.dataset.tab;o.forEach(n=>{const m=n.querySelector("svg");n.dataset.tab===t?(n.classList.remove("text-zinc-500","hover:bg-zinc-800/40","hover:text-zinc-300"),n.classList.add("bg-zinc-800/80","text-zinc-100","shadow-sm"),m&&(m.classList.remove("text-zinc-500"),m.classList.add("text-zinc-100"))):(n.classList.add("text-zinc-500","hover:bg-zinc-800/40","hover:text-zinc-300"),n.classList.remove("bg-zinc-800/80","text-zinc-100","shadow-sm"),m&&(m.classList.add("text-zinc-500"),m.classList.remove("text-zinc-100")))}),i.forEach(n=>{n.id===`tab-${t}`?(n.classList.remove("hidden"),n.classList.add("animate-fade-in")):n.classList.add("hidden")}),d.textContent=t.charAt(0).toUpperCase()+t.slice(1)})}),e.addEventListener("click",async()=>{e.disabled=!0;const l=e.innerHTML;e.textContent="Logging out...";try{await window.promptOS.auth.signOut()}catch{alert("Failed to log out"),e.disabled=!1,e.innerHTML=l}});const a=document.getElementById("settings-sidebar"),s=document.getElementById("sidebar-toggle");localStorage.getItem("sidebar-collapsed")==="true"&&(a.dataset.collapsed="true",a.classList.remove("w-[260px]"),a.classList.add("w-[80px]")),s.addEventListener("click",()=>{const t=!(a.dataset.collapsed==="true");a.dataset.collapsed=t.toString(),t?(a.classList.remove("w-[260px]"),a.classList.add("w-[80px]")):(a.classList.remove("w-[80px]"),a.classList.add("w-[260px]")),localStorage.setItem("sidebar-collapsed",t)}),x()}function x(){const o=document.getElementById("edit-name-btn"),i=document.getElementById("save-name-btn"),d=document.getElementById("display-name-view"),e=document.getElementById("display-name-edit"),a=document.getElementById("settings-display-name");o.addEventListener("click",()=>{d.classList.add("hidden"),e.classList.remove("hidden"),a.value=g.name,a.focus()});const s=async()=>{const u=a.value.trim();if(u){i.disabled=!0,i.textContent="Saving...";try{const c=await window.promptOS.profile.update({display_name:u});c.success?(g.name=u,document.getElementById("sidebar-name").textContent=u,document.getElementById("sidebar-avatar").textContent=u.charAt(0).toUpperCase(),d.classList.remove("hidden"),e.classList.add("hidden")):alert("Failed to save: "+c.error)}catch{alert("Failed to save name")}finally{i.disabled=!1,i.textContent="Save"}}};i.addEventListener("click",s);const r=document.querySelectorAll("#settings-style-grid .settings-style-card"),l=document.getElementById("settings-custom-style-container"),t=document.getElementById("settings-custom-style-input"),n=document.getElementById("save-style-btn"),m=u=>{r.forEach(c=>{const L=c.dataset.style===u,b=c.querySelector(".selection-indicator");L?(c.classList.remove("bg-zinc-900/20","border-zinc-800/50"),c.classList.add("bg-zinc-800/40","border-zinc-600/50"),c.querySelector(".title").classList.remove("text-zinc-300"),c.querySelector(".title").classList.add("text-zinc-100"),b.classList.remove("hidden"),b.classList.add("bg-zinc-100","shadow-[0_0_8px_rgba(255,255,255,0.5)]")):(c.classList.add("bg-zinc-900/20","border-zinc-800/50"),c.classList.remove("bg-zinc-800/40","border-zinc-600/50"),c.querySelector(".title").classList.add("text-zinc-300"),c.querySelector(".title").classList.remove("text-zinc-100"),b.classList.add("hidden"))}),u==="custom"?(l.classList.remove("hidden"),document.getElementById("settings-custom-placeholder").classList.add("hidden")):(l.classList.add("hidden"),document.getElementById("settings-custom-placeholder").classList.remove("hidden"))};r.forEach(u=>{u.addEventListener("click",async()=>{const c=u.dataset.style;m(c),c!=="custom"?(await window.promptOS.profile.update({writing_style:c}),g.styleId=c):(g.styleId="custom",t.value=g.customStyleText||"")})}),n.addEventListener("click",async()=>{const u=t.value.trim();if(u){n.textContent="Saving...",n.disabled=!0;try{await window.promptOS.profile.update({writing_style:"custom",writing_style_guide:u}),g.customStyleText=u,n.textContent="Saved!",setTimeout(()=>{n.textContent="Save Custom Style",n.disabled=!1},1500)}catch{alert("Failed to save style"),n.textContent="Save Custom Style",n.disabled=!1}}})}async function E(){try{const o=await window.promptOS.profile.get();if(o.success){const{display_name:e,writing_style:a,writing_style_guide:s}=o.profile;g.name=e||"",g.styleId=a||"professional",g.customStyleText=s||"",document.getElementById("sidebar-name").textContent=g.name||"User",g.name&&(document.getElementById("sidebar-avatar").textContent=g.name.charAt(0).toUpperCase()),document.getElementById("settings-display-name").value=g.name,document.getElementById("settings-custom-style-input").value=g.customStyleText;const r=document.querySelectorAll("#settings-style-grid .settings-style-card"),l=document.getElementById("settings-custom-style-container");r.forEach(t=>{const n=t.dataset.style===g.styleId,m=t.querySelector(".selection-indicator");n?(t.classList.remove("bg-zinc-900/20","border-zinc-800/50"),t.classList.add("bg-zinc-800/40","border-zinc-600/50"),t.querySelector(".title").classList.remove("text-zinc-300"),t.querySelector(".title").classList.add("text-zinc-100"),m.classList.remove("hidden"),m.classList.add("bg-zinc-100","shadow-[0_0_8px_rgba(255,255,255,0.5)]")):(t.classList.add("bg-zinc-900/20","border-zinc-800/50"),t.classList.remove("bg-zinc-800/40","border-zinc-600/50"),t.querySelector(".title").classList.add("text-zinc-300"),t.querySelector(".title").classList.remove("text-zinc-100"),m.classList.add("hidden"))}),g.styleId==="custom"?(l.classList.remove("hidden"),document.getElementById("settings-custom-placeholder").classList.add("hidden")):(l.classList.add("hidden"),document.getElementById("settings-custom-placeholder").classList.remove("hidden"))}const i=await window.promptOS.usage.getStats();if(i.success){const{tokens_used:e,tokens_remaining:a,subscription_tier:s}=i.stats,r=e+a,l=r>0?e/r*100:0;document.getElementById("usage-val").textContent=`${e.toLocaleString()} / ${r.toLocaleString()}`,document.getElementById("usage-progress-bar").style.width=`${l}%`;const t=s==="pro"?"Pro Plan":"Free Plan",n=document.getElementById("sidebar-tier");n&&(n.textContent=t);const m=document.getElementById("billing-tier");m&&(m.textContent=t)}const d=await window.promptOS.auth.getSession();if(d.success&&d.session){g.email=d.session.user.email||"";const e=document.getElementById("account-email");e&&(e.textContent=g.email)}}catch(o){console.error("Failed to load settings:",o)}}function h(){window.lucide&&window.lucide.createIcons(),v(),S(),f(),w(),(async()=>{try{const o=await window.promptOS.auth.getSession();if(o.success&&o.session){const i=await window.promptOS.profile.get();i.success&&i.profile?.onboarding_completed?p("settings"):i.success&&p("onboarding-1")}}catch{}})()}document.addEventListener("DOMContentLoaded",h);
