import{u as M,r as n,a as T,j as e,B as C,R as A,b as B,P as U}from"./styles-DuWstJ1F.js";function F(r,s){const u=M(),p=n.useRef(r),l=n.useRef(s);n.useEffect(()=>{p.current=r},[r]),n.useEffect(()=>{l.current=s},[s]),n.useEffect(()=>{const b=h=>p.current?.(h),d=()=>l.current?.(),a=r?u.onWindowShown(b):void 0,g=s?u.onWindowHidden(d):void 0;return()=>{a?.(),g?.()}},[u])}const D=e.jsx("div",{className:"w-6 h-6 rounded-full bg-[#ff5f0f] flex items-center justify-center transition-all duration-150",children:e.jsxs("svg",{width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 19V5"}),e.jsx("path",{d:"M5 12l7-7 7 7"})]})}),P=e.jsx("div",{className:"w-6 h-6 rounded-full bg-zinc-800 flex items-center justify-center border border-white/10 hover:bg-zinc-700 transition-colors animate-pulse",children:e.jsx("svg",{width:"11",height:"11",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("rect",{x:"7",y:"7",width:"10",height:"10",rx:"2"})})});function H(){const r=M(),{t:s}=T(),[u,p]=n.useState(""),[l,b]=n.useState(""),[d,a]=n.useState(""),[g,h]=n.useState(!1),x=n.useRef(null),k=n.useRef(!1),[v,m]=n.useState(""),[f,y]=n.useState(""),w=!!l,N=!!d,i=n.useCallback(()=>{p(""),b(""),a(""),m(""),y("")},[]),W=n.useCallback(t=>{i(),t?.selection&&y(t.selection),x.current?.focus()},[i]),I=n.useCallback(()=>{i()},[i]);F(W,I),n.useEffect(()=>{if(window.promptOS&&window.promptOS.onGenerationStatus)return window.promptOS.onGenerationStatus(t=>{m(t)})},[r]);const E=n.useCallback(t=>{if(!t)return"";if(t==="STATUS:ANALYZING")return s.overlay.status.analyzing;if(t==="STATUS:WRITING")return s.overlay.status.writing;if(t.startsWith("STATUS:SERVER_BUSY:")){const o=t.split(":")[2];return s.overlay.status.server_busy.replace("{seconds}",o)}return t},[s]);n.useEffect(()=>{if(window.promptOS&&window.promptOS.onContextUpdated)return window.promptOS.onContextUpdated(t=>{t?.selection&&(y(t.selection),x.current?.focus())})},[r]);const j=n.useCallback(async()=>{const t=x.current?.value.trim()||"";if(!(!t||k.current))try{k.current=!0,h(!0),a(""),m("");let o=t;f&&(o=`Context:
"""
${f}
"""

User Request:
${t}`);let S=!1;if(!f)try{const z=await r.checkContextNeed(t);S=z.needsContext,S&&(console.log("[Overlay] Including screenshot (source:",z.source,")"),m("Reading your screen..."))}catch{console.warn("[Overlay] Context check failed, continuing without screenshot")}const c=await r.generate(o,{includeScreenshot:S});c.success&&c.text?b(c.text):c.error==="GENERATION_LIMIT_REACHED"?a("GENERATION_LIMIT_REACHED"):c.error==="screen_recording_permission"?a("screen_recording_permission"):c.error==="Cancelled"?console.log("Generation cancelled by user"):a(c.error||"Failed to generate text")}catch{a("An unexpected error occurred")}finally{k.current=!1,h(!1),m("")}},[r,f]),O=n.useCallback(async()=>{k.current&&await r.cancelGeneration()},[r]),_=n.useCallback(async()=>{const t=l;if(t)try{await r.insert(t),i()}catch{a("Failed to insert text")}},[r,l,i]),G=n.useCallback(()=>{x.current?.focus(),x.current?.select()},[]),R=n.useCallback(()=>{r.dismiss(),i()},[r,i]),L=n.useCallback(t=>{t.nativeEvent.isComposing||t.repeat||(t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),j()):t.key==="Escape"&&R())},[j,R]);return n.useEffect(()=>{const t=o=>{o.key==="Escape"&&(r.dismiss(),i())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[r,i]),e.jsxs("div",{className:"bg-transparent h-screen flex flex-col justify-end items-center p-3 pb-6 font-[-apple-system,BlinkMacSystemFont,'Segoe_UI',Roboto,Oxygen,Ubuntu,sans-serif]",children:[w&&e.jsxs("div",{className:"mb-3 rounded-[20px] animate-slide-up origin-bottom w-full max-h-[calc(100vh-100px)] flex flex-col relative overflow-hidden grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[20px] pointer-events-none z-20",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor"}}),e.jsxs("div",{className:"overflow-y-auto p-5 w-full h-full relative z-10 custom-scrollbar",children:[e.jsx("div",{className:"result-text text-[15px] leading-relaxed text-gray-200 whitespace-pre-wrap pr-1",children:l}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-end pt-2",children:[e.jsx(C,{variant:"ghost",size:"sm",onClick:G,className:"text-[13px] text-gray-400 px-2.5 py-1.5 rounded-xl hover:text-gray-200 active:scale-95",children:s.overlay.refine}),e.jsx(C,{variant:"ghost",size:"sm",onClick:_,className:"bg-[#FF6B00] hover:bg-[#ff8533] text-white rounded-xl px-3.5 py-1.5 text-[13px] font-medium active:scale-95",children:s.overlay.insert})]})]})]}),N&&(d==="GENERATION_LIMIT_REACHED"?e.jsxs("div",{className:"mb-3 p-3 px-4 rounded-xl animate-slide-up w-[92%] grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsxs("div",{className:"flex items-center justify-between relative z-20",children:[e.jsx("span",{className:"text-[12px] text-zinc-400",children:"Monthly limit reached"}),e.jsx("button",{onClick:()=>{a(""),r.dismiss(),r.openBilling()},className:"text-[12px] text-[#FF6B00] hover:text-[#ff8533] transition-colors ml-3",children:"Upgrade →"})]})]}):d==="screen_recording_permission"?e.jsxs("div",{className:"mb-3 p-4 rounded-[20px] animate-slide-up w-[92%] grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[20px] pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsxs("div",{className:"flex items-start gap-3 relative z-20",children:[e.jsx("span",{className:"text-amber-400 text-base flex-shrink-0 mt-0.5",children:"⚠"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-medium text-zinc-200 mb-1",children:"Screen Recording required"}),e.jsx("p",{className:"text-[12px] text-zinc-500 leading-relaxed mb-3",children:"Enable promptOS in System Settings → Privacy & Security → Screen Recording"}),e.jsx("button",{onClick:()=>r.openSystemSettings("screen-recording"),className:"text-[12px] text-[#FF6B00] hover:text-[#ff8533] transition-colors",children:s.overlay.screen_permission.button})]}),e.jsx("button",{onClick:()=>a(""),className:"text-zinc-600 hover:text-zinc-400 transition-colors flex-shrink-0",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 6L6 18"}),e.jsx("path",{d:"M6 6l12 12"})]})})]})]}):e.jsxs("div",{className:"mb-3 p-3 px-4 rounded-xl animate-slide-up w-[92%] grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsx("span",{className:"text-[12px] text-zinc-400 relative z-20",children:d})]})),v&&!w&&!N&&e.jsxs("div",{className:"mb-3 flex items-center gap-2 p-2 px-3 rounded-xl animate-slide-up w-fit mx-auto grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsx("span",{className:"text-xs text-gray-300 italic relative z-20",children:E(v)})]}),f&&!w&&e.jsxs("div",{className:"mb-3 max-w-[90%] flex items-center gap-2 p-2 px-3 rounded-xl animate-slide-up grainy-texture",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-xl pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsxs("div",{className:"text-xs text-gray-300 italic truncate max-w-[300px] relative z-20",children:['"',f,'"']}),e.jsx("button",{onClick:()=>y(""),className:"text-gray-400 hover:text-white transition-colors relative z-20",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 6L6 18"}),e.jsx("path",{d:"M6 6l12 12"})]})})]}),e.jsxs("div",{className:"input-bar flex items-end gap-3 rounded-[20px] py-2.5 px-4 w-[92%]",style:{background:"#151516",boxShadow:"0 4px 12px rgba(0,0,0,0.5)",position:"relative"},children:[e.jsx("div",{className:"absolute inset-0 rounded-[20px] pointer-events-none",style:{padding:"1px",background:"linear-gradient(155deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 25%, rgba(255,255,255,0) 75%, rgba(255,255,255,0.4) 100%)",mask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",maskComposite:"exclude",WebkitMask:"linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0)",WebkitMaskComposite:"xor",zIndex:10}}),e.jsx("textarea",{ref:x,rows:2,value:u,onChange:t=>p(t.target.value),onKeyDown:L,placeholder:E(v)||s.overlay.placeholder,autoComplete:"off",spellCheck:!1,style:{resize:"none",overflow:"hidden",lineHeight:"1.5rem",height:"3rem"},className:"flex-1 bg-transparent border-none text-[15px] text-gray-100 outline-none font-normal placeholder:text-zinc-500"}),e.jsx(C,{variant:"ghost",size:"icon",onClick:g?O:j,disabled:!!v&&!g,className:"w-8 h-8 rounded-full hover:bg-transparent p-0 flex-shrink-0 mb-0 self-end",children:g?P:D})]})]})}A.createRoot(document.getElementById("root")).render(e.jsx(B.StrictMode,{children:e.jsx(U,{children:e.jsx(H,{})})}));
