import{u as E,r,j as e,B as S,R as M,a as W,P}from"./styles-D-P865l5.js";function F(n,c){const l=E(),i=r.useRef(n),p=r.useRef(c);r.useEffect(()=>{i.current=n},[n]),r.useEffect(()=>{p.current=c},[c]),r.useEffect(()=>{const h=a=>i.current?.(a),o=()=>p.current?.(),m=n?l.onWindowShown(h):void 0,g=c?l.onWindowHidden(o):void 0;return()=>{m?.(),g?.()}},[l])}const _=e.jsx("div",{className:"w-7 h-7 rounded-full bg-[#EA580C]/90 flex items-center justify-center shadow-md hover:bg-[#c2410c] transition-colors",children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 19V5"}),e.jsx("path",{d:"M5 12l7-7 7 7"})]})}),U=e.jsx("div",{className:"w-7 h-7 rounded-full bg-zinc-800 flex items-center justify-center border border-white/10 hover:bg-zinc-700 transition-colors animate-pulse",children:e.jsx("div",{className:"w-2 h-2 bg-white rounded-[1px]"})});function A(){const n=E(),[c,l]=r.useState(""),[i,p]=r.useState(""),[h,o]=r.useState(""),[m,g]=r.useState(!1),a=r.useRef(null),b=r.useRef(!1),[w,f]=r.useState(""),[d,v]=r.useState(""),y=!!i,C=!!h,s=r.useCallback(()=>{l(""),p(""),o(""),f(""),v("")},[]),O=r.useCallback(t=>{s(),t?.selection&&v(t.selection),a.current?.focus()},[s]),z=r.useCallback(()=>{s()},[s]);F(O,z),r.useEffect(()=>{if(window.promptOS&&window.promptOS.onGenerationStatus)return window.promptOS.onGenerationStatus(t=>{f(t)})},[n]),r.useEffect(()=>{if(window.promptOS&&window.promptOS.onContextUpdated)return window.promptOS.onContextUpdated(t=>{t?.selection&&(v(t.selection),a.current?.focus())})},[n]);const j=r.useCallback(async()=>{const t=a.current?.value.trim()||"";if(!(!t||b.current))try{b.current=!0,g(!0),o(""),f("");let u=t;d&&(u=`Context:
"""
${d}
"""

User Request:
${t}`);let k=!1;if(!d)try{const R=await n.checkContextNeed(t);k=R.needsContext,k&&(console.log("[Overlay] Including screenshot (source:",R.source,")"),f("Capturing context..."))}catch{console.warn("[Overlay] Context check failed, continuing without screenshot")}const x=await n.generate(u,{includeScreenshot:k});x.success&&x.text?p(x.text):x.error==="screen_recording_permission"?o("screen_recording_permission"):x.error==="Cancelled"?console.log("Generation cancelled by user"):o(x.error||"Failed to generate text")}catch{o("An unexpected error occurred")}finally{b.current=!1,g(!1),f("")}},[n,d]),B=r.useCallback(async()=>{b.current&&await n.cancelGeneration()},[n]),G=r.useCallback(async()=>{const t=i;if(t)try{await n.insert(t),s()}catch{o("Failed to insert text")}},[n,i,s]),I=r.useCallback(()=>{a.current?.focus(),a.current?.select()},[]),N=r.useCallback(()=>{n.dismiss(),s()},[n,s]),L=r.useCallback(t=>{t.nativeEvent.isComposing||t.repeat||(t.key==="Enter"&&!t.shiftKey?(t.preventDefault(),j()):t.key==="Escape"&&N())},[j,N]);return r.useEffect(()=>{const t=u=>{u.key==="Escape"&&(n.dismiss(),s())};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[n,s]),e.jsxs("div",{className:"bg-transparent h-screen flex flex-col justify-end items-center p-3 pb-6 font-[-apple-system,BlinkMacSystemFont,'Segoe_UI',Roboto,Oxygen,Ubuntu,sans-serif]",children:[y&&e.jsxs("div",{className:"mb-3 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-[20px] p-5 shadow-lg animate-slide-up origin-bottom w-full max-h-[calc(100vh-100px)] overflow-y-auto grainy-texture",children:[e.jsx("div",{className:"result-text text-[15px] leading-relaxed text-gray-200 whitespace-pre-wrap pr-1",children:i}),e.jsxs("div",{className:"flex gap-2 mt-2 justify-end",children:[e.jsx(S,{variant:"ghost",size:"sm",onClick:I,className:"text-[13px] text-gray-400 px-2.5 py-1.5 rounded-xl hover:text-gray-200 active:scale-95",children:"Refine"}),e.jsx(S,{variant:"ghost",size:"sm",onClick:G,className:"bg-[#FF6B00] hover:bg-[#ff8533] text-white rounded-xl px-3.5 py-1.5 text-[13px] font-medium active:scale-95",children:"Insert"})]})]}),C&&(h==="screen_recording_permission"?e.jsx("div",{className:"mb-3 p-4 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-[20px] shadow-lg animate-slide-up w-[92%] grainy-texture",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-amber-400 text-base flex-shrink-0 mt-0.5",children:"⚠"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-[13px] font-medium text-zinc-200 mb-1",children:"Screen Recording required"}),e.jsx("p",{className:"text-[12px] text-zinc-500 leading-relaxed mb-3",children:"Enable promptOS in System Settings → Privacy & Security → Screen Recording"}),e.jsx("button",{onClick:()=>n.openSystemSettings("screen-recording"),className:"text-[12px] text-[#FF6B00] hover:text-[#ff8533] transition-colors",children:"Open System Settings →"})]}),e.jsx("button",{onClick:()=>o(""),className:"text-zinc-600 hover:text-zinc-400 transition-colors flex-shrink-0",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 6L6 18"}),e.jsx("path",{d:"M6 6l12 12"})]})})]})}):e.jsx("div",{className:"mb-3 p-3 px-4 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-xl animate-slide-up w-[92%] grainy-texture",children:e.jsx("span",{className:"text-[12px] text-zinc-400",children:h})})),w&&!y&&!C&&e.jsx("div",{className:"mb-3 flex items-center gap-2 p-2 px-3 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-xl animate-slide-up w-fit mx-auto grainy-texture",children:e.jsx("span",{className:"text-xs text-gray-300 italic",children:w})}),d&&!y&&e.jsxs("div",{className:"mb-3 max-w-[90%] flex items-center gap-2 p-2 px-3 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-xl animate-slide-up grainy-texture",children:[e.jsxs("div",{className:"text-xs text-gray-300 italic truncate max-w-[300px]",children:['"',d,'"']}),e.jsx("button",{onClick:()=>v(""),className:"text-gray-400 hover:text-white transition-colors",children:e.jsxs("svg",{className:"w-3.5 h-3.5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M18 6L6 18"}),e.jsx("path",{d:"M6 6l12 12"})]})})]}),e.jsxs("div",{className:"input-bar flex items-center gap-3.5 bg-[#252525] bg-gradient-to-b from-white/[0.04] to-transparent border border-white/[0.08] backdrop-blur-xl rounded-[28px] py-2.5 px-5 shadow-lg w-[92%] grainy-texture",children:[e.jsx("img",{src:"logo.png",className:"w-6 h-6 object-contain flex-shrink-0 opacity-80",alt:"Logo"}),e.jsx("input",{ref:a,type:"text",value:c,onChange:t=>l(t.target.value),onKeyDown:L,placeholder:w||"Ask AI...",autoComplete:"off",spellCheck:!1,className:"flex-1 bg-transparent border-none text-base text-gray-100 outline-none font-normal placeholder:text-gray-500"}),e.jsx(S,{variant:"ghost",size:"icon",onClick:m?B:j,disabled:!!w&&!m,className:"w-7 h-7 rounded-full hover:bg-transparent p-0",children:m?U:_})]})]})}M.createRoot(document.getElementById("root")).render(e.jsx(W.StrictMode,{children:e.jsx(P,{children:e.jsx(A,{})})}));
